
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal blog by Thomas F McGeehan V">
      
      
        <meta name="author" content="Thomas F McGeehan V">
      
      
        <link rel="canonical" href="https://tfmv.github.io/blog/blog-posts/quiver/">
      
      
        <link rel="prev" href="../pygomo/">
      
      
        <link rel="next" href="../rust-vs-go/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.6">
    
    
      
        <title>Quiver - Blog - Thomas F McGeehan V</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Quiver - Blog - Thomas F McGeehan V" >
      
        <meta  property="og:description"  content="Personal blog by Thomas F McGeehan V" >
      
        <meta  property="og:image"  content="https://tfmv.github.io/blog/assets/images/social/blog-posts/quiver.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://tfmv.github.io/blog/blog-posts/quiver/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Quiver - Blog - Thomas F McGeehan V" >
      
        <meta  name="twitter:description"  content="Personal blog by Thomas F McGeehan V" >
      
        <meta  name="twitter:image"  content="https://tfmv.github.io/blog/assets/images/social/blog-posts/quiver.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-a-hybrid-vector-search-database-with-arrow-and-duckdb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Blog - Thomas F McGeehan V" class="md-header__button md-logo" aria-label="Blog - Thomas F McGeehan V" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Blog - Thomas F McGeehan V
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quiver
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TFMV/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../arrow-ecosystem/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Blog - Thomas F McGeehan V" class="md-nav__button md-logo" aria-label="Blog - Thomas F McGeehan V" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Blog - Thomas F McGeehan V
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TFMV/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arrow-ecosystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arrow Ecosystem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flight/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arrow Flight
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../billion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Billion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blink
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../go-arrow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Go and Arrow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Living Databases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pygomo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mojo is Fast
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Quiver
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rust-vs-go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rust vs Go
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unilateral-bond/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Unilateral Bond
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fs-hacker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Walking the Filesystem like a Hacker
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="building-a-hybrid-vector-search-database-with-arrow-and-duckdb">Building a Hybrid Vector Search Database with Arrow and DuckDB<a class="headerlink" href="#building-a-hybrid-vector-search-database-with-arrow-and-duckdb" title="Permanent link">#</a></h1>
<hr />
<h2 id="how-we-combined-hnsw-for-fast-vector-search-with-sql-based-metadata-filtering-for-a-next-gen-ai-database">How we combined HNSW for fast vector search with SQL-based metadata filtering for a next-gen AI database<a class="headerlink" href="#how-we-combined-hnsw-for-fast-vector-search-with-sql-based-metadata-filtering-for-a-next-gen-ai-database" title="Permanent link">#</a></h2>
<p>Vector databases are no longer optional. As embeddings-based applications explode across industries, developers need speed, flexibility, and efficiency when storing, searching, and retrieving high-dimensional vectors. But here&rsquo;s the problem:</p>
<p>Most vector databases force you to choose between raw performance and SQL-powered filtering.</p>
<p>That&rsquo;s why we built Quiver — a Go-powered, hybrid vector database that delivers the best of both worlds:</p>
<ul>
<li>✅ HNSW for fast, high-recall vector search</li>
<li>✅ DuckDB for structured metadata filtering</li>
<li>✅ Apache Arrow for efficient, zero-copy data movement</li>
</ul>
<p>With Quiver, you can run complex queries that mix vector similarity with structured constraints — without killing performance.</p>
<p>This article isn&rsquo;t just a high-level introduction. We&rsquo;re diving deep into the internals — how I integrated Apache Arrow, optimized DuckDB for metadata management, and built a high-speed HNSW index — to create a vector search engine that doesn&rsquo;t compromise.</p>
<p>Let&rsquo;s get into it.</p>
<h2 id="vector-databases-have-a-problem">Vector Databases Have a Problem<a class="headerlink" href="#vector-databases-have-a-problem" title="Permanent link">#</a></h2>
<p>Vector databases are critical infrastructure for AI applications — powering everything from semantic search and recommendation systems to image similarity and anomaly detection. But despite their importance, most solutions come with serious trade-offs.</p>
<h3 id="where-existing-vector-databases-fall-short">Where Existing Vector Databases Fall Short<a class="headerlink" href="#where-existing-vector-databases-fall-short" title="Permanent link">#</a></h3>
<ul>
<li>🔥 <strong>Performance vs. Flexibility Trade-offs</strong> → Most vector databases are built for either fast similarity search or rich metadata filtering — not both. If you want speed, you lose SQL-style filtering. If you want SQL filtering, you lose performance.</li>
<li>🔥 <strong>Heavy Resource Consumption</strong> → Many solutions demand huge memory and CPU overhead to maintain vector indices, making them expensive at scale.</li>
<li>🔥 <strong>Operational Complexity</strong> → Most vector databases require careful tuning, background maintenance processes, and periodic reindexing to stay performant.</li>
<li>🔥 <strong>Integration Challenges</strong> → Existing solutions often sit outside an organization&rsquo;s primary data stack, requiring custom pipelines and workarounds to sync with relational databases and analytical engines.</li>
</ul>
<h3 id="how-existing-solutions-approach-the-problem">How Existing Solutions Approach the Problem<a class="headerlink" href="#how-existing-solutions-approach-the-problem" title="Permanent link">#</a></h3>
<p>Current vector search solutions take different approaches, each with trade-offs:</p>
<ul>
<li><strong>Weaviate</strong> → Uses HNSW for vector search with a GraphQL-based query engine. Weaviate allows metadata filtering but stores metadata in RocksDB, which comes with additional operational overhead.</li>
<li><strong>Pinecone</strong> → A managed service optimized for fast retrieval, but you lose control over the underlying infrastructure and can&rsquo;t easily run it locally.</li>
<li><strong>FAISS</strong> → A highly optimized C++ library for pure vector search — but lacks a built-in metadata store, requiring developers to pair it with an external database.</li>
<li><strong>pgvector</strong> → Brings vector search inside PostgreSQL, enabling SQL-based filtering, but scales poorly on large datasets due to PostgreSQL&rsquo;s row-based storage.</li>
</ul>
<h2 id="why-we-built-quiver">Why We Built Quiver<a class="headerlink" href="#why-we-built-quiver" title="Permanent link">#</a></h2>
<p>We wanted a vector database that didn&rsquo;t force these trade-offs — one that keeps up with the best ANN search engines while supporting rich, efficient metadata filtering.</p>
<ul>
<li>✅ HNSW for high-speed vector search</li>
<li>✅ DuckDB for SQL-powered metadata filtering</li>
<li>✅ Apache Arrow for zero-copy, high-performance data movement</li>
</ul>
<p>Quiver avoids the overhead of external databases, scales efficiently, and fits seamlessly into modern AI and analytics stacks. Let&rsquo;s break down how it works.</p>
<h2 id="under-the-hood">Under the Hood<a class="headerlink" href="#under-the-hood" title="Permanent link">#</a></h2>
<p>Quiver is built on three key components, each designed to maximize speed, flexibility, and efficiency:</p>
<p>1️⃣ <strong>Vector Index</strong> → An HNSW (Hierarchical Navigable Small World) graph for fast approximate nearest neighbor (ANN) search.<br />
2️⃣ <strong>Metadata Store</strong> → A DuckDB-backed SQL engine for structured metadata filtering.<br />
3️⃣ <strong>Arrow Appender</strong> → A zero-copy data pipeline powered by Apache Arrow, keeping everything memory-efficient and fast.</p>
<p>These pieces work together to eliminate the trade-offs most vector databases force you to make — allowing queries that combine vector similarity with structured constraints without wrecking performance.</p>
<h3 id="blazing-fast-search-the-vector-index">Blazing-Fast Search: The Vector Index<a class="headerlink" href="#blazing-fast-search-the-vector-index" title="Permanent link">#</a></h3>
<p>At the core of Quiver&rsquo;s vector search engine is HNSW (Hierarchical Navigable Small World) — a graph-based ANN algorithm built for speed and scalability.</p>
<p>HNSW is what makes Quiver&rsquo;s search both fast and accurate, offering logarithmic search complexity while keeping recall high. It works by constructing a multi-layered graph where similar vectors cluster together, drastically reducing the number of comparisons needed for a query.</p>
<p>Our Go-based implementation of HNSW is optimized for:</p>
<ul>
<li>✅ Memory efficiency → Minimizing index size without sacrificing recall.</li>
<li>✅ High-speed inserts → Batch processing for fast vector ingestion.</li>
<li>✅ Precision tuning → Fine-grained control over search parameters for balancing speed vs. accuracy.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Index</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">config</span><span class="w">          </span><span class="nx">Config</span>
<span class="w">    </span><span class="nx">hnsw</span><span class="w">            </span><span class="o">*</span><span class="nx">hnsw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">[</span><span class="kt">uint64</span><span class="p">]</span>
<span class="w">    </span><span class="nx">metadata</span><span class="w">        </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint64</span><span class="p">]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">vectors</span><span class="w">         </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint64</span><span class="p">][]</span><span class="kt">float32</span>
<span class="w">    </span><span class="nx">duckdb</span><span class="w">          </span><span class="o">*</span><span class="nx">DuckDB</span>
<span class="w">    </span><span class="nx">dbConn</span><span class="w">          </span><span class="o">*</span><span class="nx">DuckDBConn</span>
<span class="w">    </span><span class="c1">// Additional fields omitted for brevity</span>
<span class="p">}</span>
</code></pre></div>
<p>The HNSW graph is parameterized by several key configuration options:</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Config</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Dimension</span><span class="w">       </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">StoragePath</span><span class="w">     </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Distance</span><span class="w">        </span><span class="nx">DistanceMetric</span>
<span class="w">    </span><span class="nx">MaxElements</span><span class="w">     </span><span class="kt">uint64</span>
<span class="w">    </span><span class="nx">HNSWM</span><span class="w">           </span><span class="kt">int</span><span class="w"> </span><span class="c1">// HNSW hyperparameter M</span>
<span class="w">    </span><span class="nx">HNSWEfConstruct</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="c1">// HNSW hyperparameter efConstruction</span>
<span class="w">    </span><span class="nx">HNSWEfSearch</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="c1">// HNSW hyperparameter ef used during queries</span>
<span class="w">    </span><span class="nx">BatchSize</span><span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="c1">// Number of vectors to batch before insertion</span>
<span class="w">    </span><span class="c1">// Additional fields omitted for brevity</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>HNSWM</code> parameter controls the maximum number of connections per node in the graph, while <code>HNSWEfConstruct</code> and <code>HNSWEfSearch</code> control the search breadth during index construction and query time, respectively. These parameters allow for fine-tuning the trade-off between search speed and accuracy.</p>
<h3 id="sql-meets-vectors-the-metadata-store">SQL Meets Vectors: The Metadata Store<a class="headerlink" href="#sql-meets-vectors-the-metadata-store" title="Permanent link">#</a></h3>
<p>What sets Quiver apart isn&rsquo;t just fast vector search — it&rsquo;s fast vector search with real SQL filtering. That&rsquo;s where DuckDB comes in.</p>
<p>Unlike traditional vector databases that rely on key-value stores or embedded document storage, Quiver uses DuckDB, an in-process analytical database built for speed. This gives us:</p>
<ul>
<li>✅ Full SQL Support → Complex metadata filtering, joins, and aggregations.</li>
<li>✅ Columnar Storage → Optimized for analytical workloads, not just key-value lookups.</li>
<li>✅ Blazing-Fast Queries → DuckDB is vectorized, meaning it processes queries in parallel with SIMD acceleration.</li>
<li>✅ Minimal Overhead → No need for a heavyweight external database — DuckDB runs entirely in-memory when needed.</li>
</ul>
<p>Our DuckDB integration is designed to be lightweight but powerful, ensuring that metadata queries never become the bottleneck. This is what makes Quiver more than just a vector store — it&rsquo;s a vector-native database that actually understands your data.</p>
<h3 id="bridging-the-gap-with-apache-arrow">Bridging the Gap with Apache Arrow<a class="headerlink" href="#bridging-the-gap-with-apache-arrow" title="Permanent link">#</a></h3>
<p>HNSW handles fast vector search. ✅<br />
DuckDB gives us powerful SQL filtering. ✅</p>
<p>But there&rsquo;s a missing piece: efficient data movement between them.</p>
<p>Even with a blazing-fast vector index and a high-performance metadata store, Quiver needed a way to move data seamlessly between components — without serialization overhead, unnecessary memory copies, or slow conversion steps.</p>
<p>That&rsquo;s where Apache Arrow comes in.</p>
<h4 id="arrow-as-the-data-backbone">Arrow as the Data Backbone<a class="headerlink" href="#arrow-as-the-data-backbone" title="Permanent link">#</a></h4>
<p>Quiver doesn&rsquo;t just use DuckDB — it integrates with it at the memory level. Instead of relying on traditional row-based data movement (which would force slow conversions and copies), we use Arrow Database Connectivity (ADBC) to communicate directly with DuckDB in Arrow-native format.</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">DuckDB</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">mu</span><span class="w">     </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<span class="w">    </span><span class="nx">db</span><span class="w">     </span><span class="nx">adbc</span><span class="p">.</span><span class="nx">Database</span>
<span class="w">    </span><span class="nx">driver</span><span class="w"> </span><span class="nx">adbc</span><span class="p">.</span><span class="nx">Driver</span>
<span class="w">    </span><span class="nx">opts</span><span class="w">   </span><span class="nx">DuckDBOptions</span>
<span class="w">    </span><span class="nx">conns</span><span class="w">  </span><span class="p">[]</span><span class="o">*</span><span class="nx">DuckDBConn</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">DuckDBConn</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">parent</span><span class="w"> </span><span class="o">*</span><span class="nx">DuckDB</span>
<span class="w">    </span><span class="nx">conn</span><span class="w">   </span><span class="nx">adbc</span><span class="p">.</span><span class="nx">Connection</span>
<span class="p">}</span>
</code></pre></div>
<p>With ADBC, metadata queries return results as Arrow RecordBatches, which can be processed without ever leaving columnar memory. This means that vector search results and metadata lookups stay fast, efficient, and zero-copy.</p>
<h4 id="why-apache-arrow">Why Apache Arrow?<a class="headerlink" href="#why-apache-arrow" title="Permanent link">#</a></h4>
<p>Most vector databases waste CPU cycles shuffling bytes around — loading, converting, and copying data between different formats. Arrow eliminates this problem by keeping everything in a single, efficient memory format.</p>
<p>Here&rsquo;s why that matters:</p>
<ul>
<li>✅ Zero-Copy Data Transfer → No serialization/deserialization overhead when moving data between Quiver&rsquo;s components.</li>
<li>✅ Columnar Storage Efficiency → DuckDB and Arrow both use columnar formats, making queries and analytics dramatically faster.</li>
<li>✅ Interoperability → Because Arrow is a standard, Quiver can integrate seamlessly with Python, PostgreSQL, Spark, and other modern data tools.</li>
<li>✅ SIMD-Optimized Execution → Arrow enables vectorized processing, meaning modern CPUs can scan and compute over large datasets much faster.</li>
</ul>
<h4 id="how-quiver-uses-arrow">How Quiver Uses Arrow<a class="headerlink" href="#how-quiver-uses-arrow" title="Permanent link">#</a></h4>
<p>We leverage Arrow in two key areas:</p>
<p>1️⃣ <strong>Ingesting Data</strong> → Bulk-loading vectors and metadata without format conversion.<br />
2️⃣ <strong>Query Results</strong> → Returning search results in an Arrow-native format, making downstream processing in analytics engines or ML pipelines much faster.</p>
<p>By eliminating data movement bottlenecks, Arrow makes Quiver more than just a vector search engine — it&rsquo;s a high-performance data pipeline that fits seamlessly into modern AI and analytics stacks.</p>
<h2 id="hybrid-search-vector-similarity-meets-sql-filtering">Hybrid Search: Vector Similarity Meets SQL Filtering<a class="headerlink" href="#hybrid-search-vector-similarity-meets-sql-filtering" title="Permanent link">#</a></h2>
<p>Raw vector search is powerful — but it&rsquo;s not enough.</p>
<p>Real-world use cases demand more than just similarity matching. You don&rsquo;t just want to find the most similar product images — you want to filter by price, category, stock status, or user preferences.</p>
<p>That&rsquo;s what makes Quiver different.</p>
<p>By combining HNSW for vector search with DuckDB for structured filtering, Quiver enables hybrid search — queries that mix semantic similarity with SQL-based constraints in a way that&rsquo;s both fast and flexible.</p>
<p>For example:</p>
<p>🔍 Find the 10 most similar product images, but only include products that are in stock and priced under $50.</p>
<p>This kind of query is impossible in most vector databases without pre-filtering or complex workarounds. Quiver makes it seamless.</p>
<h3 id="two-approaches-to-hybrid-search">Two Approaches to Hybrid Search<a class="headerlink" href="#two-approaches-to-hybrid-search" title="Permanent link">#</a></h3>
<p>Quiver supports two ways to combine vector search with metadata filtering, depending on the use case:</p>
<p>1️⃣ <strong>Pre-Filtering (SQL First, Vector Search Later)</strong></p>
<p>When metadata constraints are highly selective, Quiver filters first — using DuckDB to narrow down the dataset before running vector search on a smaller set of candidates.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">*</span><span class="nx">Index</span><span class="p">)</span><span class="w"> </span><span class="nx">SearchWithFilter</span><span class="p">(</span><span class="nx">query</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">,</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">SearchResult</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Execute SQL filter query</span>
<span class="w">    </span><span class="nx">filteredIDs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">executeFilterQuery</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Perform vector search on filtered subset</span>
<span class="w">    </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">searchFiltered</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">filteredIDs</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p>✅ Best for: Narrowing down a large dataset when the metadata filter eliminates most records.</p>
<p>2️⃣ <strong>Post-Filtering (Vector Search First, SQL Later)</strong></p>
<p>When vector similarity is the dominant factor, Quiver runs the ANN search first, then filters the results using DuckDB.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">*</span><span class="nx">Index</span><span class="p">)</span><span class="w"> </span><span class="nx">SearchWithPostFilter</span><span class="p">(</span><span class="nx">query</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">,</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">SearchResult</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Perform vector search with a larger k to account for filtering</span>
<span class="w">    </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">k</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract IDs for filtering</span>
<span class="w">    </span><span class="nx">ids</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">uint64</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">results</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ids</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">ID</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Apply filter to results</span>
<span class="w">    </span><span class="nx">filteredResults</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">filterResults</span><span class="p">(</span><span class="nx">ids</span><span class="p">,</span><span class="w"> </span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">k</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">filteredResults</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p>✅ Best for: Cases where the vector search results are already highly relevant, and metadata filtering is secondary.</p>
<h3 id="how-quiver-optimizes-hybrid-search">How Quiver Optimizes Hybrid Search<a class="headerlink" href="#how-quiver-optimizes-hybrid-search" title="Permanent link">#</a></h3>
<p>Quiver doesn&rsquo;t just run both steps in sequence — it chooses the best approach dynamically based on the query.</p>
<ul>
<li>If the metadata filter is highly selective → Pre-filtering is faster.</li>
<li>If the metadata filter is loose → Post-filtering avoids unnecessary constraints.</li>
</ul>
<p>By intelligently switching between these approaches, Quiver avoids the performance pitfalls that make hybrid search slow in other databases.</p>
<p>The result? A system that feels as fast as raw vector search but acts as flexible as a SQL database.</p>
<h2 id="making-quiver-fast-at-scale">Making Quiver Fast at Scale<a class="headerlink" href="#making-quiver-fast-at-scale" title="Permanent link">#</a></h2>
<p>Building a vector database is one thing — making it fast and scalable is another.</p>
<p>Quiver isn&rsquo;t just optimized for raw search speed. We&rsquo;ve engineered it for high-throughput inserts, low-latency queries, and efficient storage — without unnecessary overhead.</p>
<p>Here&rsquo;s how we make it fast.</p>
<h3 id="1-batch-processing-for-high-speed-ingestion">1️⃣ Batch Processing for High-Speed Ingestion<a class="headerlink" href="#1-batch-processing-for-high-speed-ingestion" title="Permanent link">#</a></h3>
<p>Vector addition needs to be fast and scalable, especially when ingesting large datasets. Instead of inserting vectors one by one, Quiver batches inserts to improve throughput.</p>
<p>Each new vector is added to a buffer, which is flushed in bulk once it reaches the configured batch size:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">*</span><span class="nx">Index</span><span class="p">)</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">uint64</span><span class="p">,</span><span class="w"> </span><span class="nx">vector</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">,</span><span class="w"> </span><span class="nx">meta</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Add to batch buffer</span>
<span class="w">    </span><span class="nx">idx</span><span class="p">.</span><span class="nx">batchLock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="nx">idx</span><span class="p">.</span><span class="nx">batchBuffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">idx</span><span class="p">.</span><span class="nx">batchBuffer</span><span class="p">,</span><span class="w"> </span><span class="nx">vectorMeta</span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="p">:</span><span class="w">     </span><span class="nx">id</span><span class="p">,</span>
<span class="w">        </span><span class="nx">vector</span><span class="p">:</span><span class="w"> </span><span class="nx">vector</span><span class="p">,</span>
<span class="w">        </span><span class="nx">meta</span><span class="p">:</span><span class="w">   </span><span class="nx">meta</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">idx</span><span class="p">.</span><span class="nx">batchLock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Flush batch if it reaches the configured size</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">idx</span><span class="p">.</span><span class="nx">batchBuffer</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">BatchSize</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">flushBatch</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p>A background goroutine automatically flushes the batch buffer, ensuring optimal insert performance without blocking writes.</p>
<p>✅ Why it matters: Batching minimizes disk I/O and computational overhead, making bulk imports orders of magnitude faster than inserting vectors individually.</p>
<h3 id="2-caching-for-low-latency-metadata-lookups">2️⃣ Caching for Low-Latency Metadata Lookups<a class="headerlink" href="#2-caching-for-low-latency-metadata-lookups" title="Permanent link">#</a></h3>
<p>Metadata filtering is a key feature of Quiver, but repeated database queries can slow things down.</p>
<p>To avoid unnecessary lookups, Quiver caches metadata in memory:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">*</span><span class="nx">Index</span><span class="p">)</span><span class="w"> </span><span class="nx">getMetadata</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">uint64</span><span class="p">)</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check cache first</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">meta</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">meta</span><span class="p">.(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Fetch from database if not in cache</span>
<span class="w">    </span><span class="nx">idx</span><span class="p">.</span><span class="nx">lock</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<span class="w">    </span><span class="nx">meta</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">idx</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>
<span class="w">    </span><span class="nx">idx</span><span class="p">.</span><span class="nx">lock</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Store in cache for future use</span>
<span class="w">        </span><span class="nx">idx</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">Store</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">meta</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">meta</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<p>✅ Why it matters: Instead of hitting DuckDB for every query, Quiver retrieves frequently accessed metadata from memory, significantly reducing query latency.</p>
<h3 id="3-efficient-persistence-and-backup">3️⃣ Efficient Persistence and Backup<a class="headerlink" href="#3-efficient-persistence-and-backup" title="Permanent link">#</a></h3>
<p>Speed is important, but so is data durability.</p>
<p>Quiver supports efficient persistence and backup mechanisms to ensure that vector indices and metadata aren&rsquo;t lost.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">*</span><span class="nx">Index</span><span class="p">)</span><span class="w"> </span><span class="nx">persistToStorage</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Implementation details for persisting the index to disk</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">idx</span><span class="w"> </span><span class="o">*</span><span class="nx">Index</span><span class="p">)</span><span class="w"> </span><span class="nx">Backup</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">incremental</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">compress</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Implementation details for creating backups</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>🔹 Incremental backups → Store only what&rsquo;s changed, minimizing storage costs.</li>
<li>🔹 Compression options → Reduce disk space usage without compromising speed.</li>
</ul>
<p>✅ Why it matters: Quiver provides persistence without sacrificing performance, ensuring that large-scale vector indices remain both durable and efficient.</p>
<h2 id="how-fast-is-quiver">How Fast is Quiver?<a class="headerlink" href="#how-fast-is-quiver" title="Permanent link">#</a></h2>
<p>Speed isn&rsquo;t just a feature — it&rsquo;s the foundation of a great vector database.</p>
<p>We built Quiver to handle high-throughput inserts, low-latency queries, and efficient hybrid search without the performance bottlenecks that plague traditional solutions. Here&rsquo;s what that looks like in practice (benchmarked on an M2 Pro CPU):</p>
<ul>
<li>✅ Fast Vector Search → 16.9K queries per second with 59µs latency.</li>
<li>✅ Hybrid Search (Vectors + SQL Filtering) → 4.8K queries per second with 208µs latency.</li>
<li>✅ Negative Search (Exclusion-based ranking) → 7.9K queries per second, dynamically reranking results in 126µs.</li>
<li>✅ Batch Inserts (1,000 vectors at a time) → 6.6 batches per second, processing 19MB per batch.</li>
</ul>
<p>For real-time applications, sub-millisecond query times mean Quiver can scale effortlessly across millions of vectors. Whether you&rsquo;re handling embeddings for AI-powered search, large-scale recommendations, or anomaly detection, Quiver delivers speed without compromise.</p>
<h2 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">#</a></h2>
<p>Quiver&rsquo;s hybrid search capabilities allow you to go beyond simple vector similarity by incorporating metadata filtering, ranking, and exclusion-based logic in a single query.</p>
<p>Let&rsquo;s explore two powerful use cases:</p>
<p>🔹 <strong>Simple Example: Find Relevant Documents</strong></p>
<p>A basic use case for Quiver is semantic search with filtering — for example, retrieving the most relevant news articles published in the past week.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Find documents similar to the query that were published in the last 7 days</span>
<span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">index</span><span class="p">.</span><span class="nx">SearchWithFilter</span><span class="p">(</span>
<span class="w">    </span><span class="nx">queryVector</span><span class="p">,</span>
<span class="w">    </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;published_date &gt; DATE_SUB(NOW(), INTERVAL 7 DAY)&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>This ensures only recent documents are returned while still ranking results based on vector similarity.</p>
<p>🔹 <strong>Advanced Example: Negative Search (Excluding Irrelevant Matches)</strong></p>
<p>In many applications, it&rsquo;s not enough to just find similar items — you also need to exclude certain results.</p>
<p>For example, a recommendation system might want to:</p>
<ul>
<li>Find items similar to what a user likes ✅</li>
<li>Exclude items they&rsquo;ve already purchased ❌</li>
<li>Avoid items that match known negative preferences ❌</li>
</ul>
<p>Instead of filtering metadata after the fact, Quiver reranks results in the vector space, actively pushing down unwanted matches using a negative search query.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Find movies similar to what the user likes but exclude those they disliked</span>
<span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">index</span><span class="p">.</span><span class="nx">SearchWithNegatives</span><span class="p">(</span>
<span class="w">    </span><span class="nx">likedMovieVector</span><span class="p">,</span><span class="w">    </span><span class="c1">// Positive query</span>
<span class="w">    </span><span class="nx">dislikedMovieVectors</span><span class="p">,</span><span class="w"> </span><span class="c1">// Negative queries</span>
<span class="w">    </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">          </span><span class="c1">// k, page, pageSize</span>
<span class="p">)</span>
</code></pre></div>
<p>Under the hood, Quiver:</p>
<ul>
<li>✅ Performs a high-recall vector search to find candidates</li>
<li>✅ Computes similarity to both positive and negative examples</li>
<li>✅ Reranks results, pushing down items similar to the negative examples</li>
</ul>
<p>This approach improves recommendation accuracy, ensuring the user sees highly relevant, non-repetitive results.</p>
<h3 id="why-negative-search-matters">Why Negative Search Matters<a class="headerlink" href="#why-negative-search-matters" title="Permanent link">#</a></h3>
<p>Most vector databases can&rsquo;t handle exclusion-based ranking efficiently — forcing developers to run multiple queries and manually filter results.</p>
<p>Quiver&rsquo;s built-in negative search allows:</p>
<ul>
<li>✅ Personalized recommendations (exclude previously seen or irrelevant items)</li>
<li>✅ Bias reduction in search results (downweight unwanted clusters)</li>
<li>✅ More diverse results by actively discouraging over-represented embeddings</li>
</ul>
<h2 id="the-future-of-hybrid-search-is-here">The Future of Hybrid Search is Here<a class="headerlink" href="#the-future-of-hybrid-search-is-here" title="Permanent link">#</a></h2>
<p>Quiver isn&rsquo;t just another vector database. It&rsquo;s a fundamental rethink of what&rsquo;s possible when you combine fast similarity search, real SQL filtering, and zero-copy data movement into a single, high-performance system.</p>
<p>Instead of forcing trade-offs between speed and flexibility, Quiver embraces both, enabling hybrid search that feels natural and runs at scale.</p>
<p>We built Quiver because we saw an opportunity to do things differently — to eliminate bottlenecks, remove complexity, and provide a vector-native database that integrates seamlessly into modern AI and analytics stacks.</p>
<p>And this is just the beginning.</p>
<h2 id="get-involved">Get Involved<a class="headerlink" href="#get-involved" title="Permanent link">#</a></h2>
<p>Quiver is open source. That means you can:</p>
<ul>
<li>✅ Try it today → Get started with a few lines of Go.</li>
<li>✅ Contribute → Help shape the future of hybrid vector search.</li>
<li>✅ Join the discussion → We&rsquo;re building this in the open, and we want your feedback.</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">March 7, 2025</span>
  </span>

    
    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TFMV" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/TFMV" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>